(function(u){typeof define=="function"&&define.amd?define(u):u()})(function(){"use strict";var j=Object.defineProperty;var R=(u,p,h)=>p in u?j(u,p,{enumerable:!0,configurable:!0,writable:!0,value:h}):u[p]=h;var f=(u,p,h)=>(R(u,typeof p!="symbol"?p+"":p,h),h);const u=["overlayCheckout","salesFunnel","inlineCheckout","jsInterface","element:creditCardForm"],p=(c,n)=>{const{id:t,minHeight:s,minWidth:o}=n,e=document.createElement("iframe");return t&&(e.id=t),e.className="custom-element__iframe",e.style.width="100%",e.style.minWidth=o??"320px",e.style.minHeight=s??"300px",e.style.border="0 none",e.style.display="block",e.allow="clipboard-write; payment *",e.src=c,e},h="https://pay.hotmart.com";class _{constructor(n,t){f(this,"options",{payment:{},visibilityOptions:{}});f(this,"wrapperElement");f(this,"iframeElement");f(this,"iframeURL",new URL(h));f(this,"iframeOptions",{});this.options=n,console.debug("@@@@ this.options:",this.options);const o={...{elements_document_height_update:e=>{this.iframeElement&&(this.iframeElement.style.height=e)},on_load:e=>{var l,y,m,a,r,i,d,v,b,g,I;this.postMessage({action:"set_data",data:{shopperData:(l=this.options.payment)==null?void 0:l.shopperData,hasErrorCallback:!!((y=this.options.payment)!=null&&y.onError),countryIsoCode:((m=this.options)==null?void 0:m.countryIsoCode)??"",gateways:(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.gateways,context:(b=(v=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:v.creditCardForm)==null?void 0:b.context}}),(I=(g=this.options)==null?void 0:g.onLoad)==null||I.call(g,e)}},...t||{}};window.addEventListener("message",e=>{var y;const l=e.source!==((y=this.iframeElement)==null?void 0:y.contentWindow);e.origin!==this.iframeURL.origin||l||(console.debug("@@@@ message:",e),!(!e.data.action||!Object.keys(o).includes(e.data.action))&&o[e.data.action](e.data.data))})}updateOptions(n){this.options={...this.options,...n}}postMessage({action:n,data:t}){var s,o;(o=(s=this.iframeElement)==null?void 0:s.contentWindow)==null||o.postMessage({action:n,data:t},"*")}_buildIframeUrl(){if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[n,t]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(n,t);if(this.options.visibilityOptions)for(const[n,t]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(n,t)}mount(n){var s;this._buildIframeUrl();const t=p(this.iframeURL.href,this.iframeOptions);this.iframeElement=t,this.wrapperElement=typeof n=="string"?document.querySelector(n):n,this.wrapperElement&&(this.wrapperElement.innerHTML="",(s=this.wrapperElement)==null||s.appendChild(t),console.debug("@@@@ element mounted successfully"))}}class O extends _{constructor(t){const s={on_load_data:o=>{var e,l;(l=(e=this.options)==null?void 0:e.onLoadData)==null||l.call(e,o)},on_payment_approve:o=>{var e;(e=this.paymentPromise)==null||e.resolve(o),this.paymentPromise=void 0},on_payment_analysis:o=>{var e;(e=this.paymentPromise)==null||e.resolve(o),this.paymentPromise=void 0},on_payment_error:o=>{var e;console.log("@@@@ on_payment_error",o),(e=this.paymentPromise)==null||e.reject(o),this.paymentPromise=void 0}};t.payment={...t.payment,onError:()=>{}};super(t,s);f(this,"paymentPromise");this.iframeURL=this.buildIframeUrl(t.offer),console.debug("@@@@ Initializing CheckoutJSInterface"),this.mount()}buildIframeUrl(t){if(!t||t.trim()==="")throw new Error("Offer cannot be empty");return new URL(`${h}/elements/js-interface?off=${t}&checkoutMode=2`)}createInvisibleIframe(){const t=p(this.iframeURL.href,this.iframeOptions);return t.id="checkout-js-interface-iframe",t.style.display="none",t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.border="0",t.style.top="-9999px",t.style.left="-9999px",console.debug("@@@@ CheckoutJsInterface element mounted invisibly"),t}mount(){if(this.iframeElement){console.warn("CheckoutJSInterface element already mounted.");return}const t=document.getElementById("checkout-js-interface-iframe");t&&t.remove(),this._buildIframeUrl(),this.iframeElement=this.createInvisibleIframe(),document.body.appendChild(this.iframeElement)}async processPayment(t){if(this.paymentPromise)throw new Error("A payment is already in progress");return this.postMessage({action:"process_payment",data:t}),new Promise((s,o)=>{this.paymentPromise={resolve:s,reject:o}})}}const T="https://pci-pay.hotmart.com";class C extends _{constructor(n,t){const s={on_payment_approve:o=>{var e,l;(l=(e=this.options.payment)==null?void 0:e.onSuccess)==null||l.call(e,o)},on_payment_error:o=>{var e,l;(l=(e=this.options.payment)==null?void 0:e.onError)==null||l.call(e,o)},on_submit_payment:({actionToCall:o})=>{var e,l;this.postMessage({action:"process_payment",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((l=this.options.payment)!=null&&l.onError),actionToCall:o}})},...t||{}};super(n,s),this.iframeURL=new URL(`${h}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class x extends C{constructor(n){super(n),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>z).then(t=>{const s=document.createElement("style");s.innerText=t.default,document.head.append(s)})}onKeyUp(n){n.key==="Escape"&&this.destroy()}attach(n){const t=typeof n=="string"?document.querySelector(n):n;n&&(t==null||t.addEventListener("click",s=>{s.preventDefault();const o=document.createElement("div");o.id="custom-element-lightbox-overlay",o.className="custom-element__lightbox-overlay",o.addEventListener("click",()=>{this.destroy()});const e=document.createElement("div");e.id="custom-element-lightbox-modal",e.className="custom-element__lightbox-modal",super.mount(e),document.body.appendChild(o),document.body.appendChild(e)}),document.addEventListener("keyup",s=>this.onKeyUp(s)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(n){this.attach(n)}destroy(){var n,t;(n=document.getElementById("custom-element-lightbox-overlay"))==null||n.remove(),(t=document.getElementById("custom-element-lightbox-modal"))==null||t.remove()}}class U extends C{constructor(n){super(n),this.iframeURL=new URL(`${h}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var n;try{const t=(n=window.top)==null?void 0:n.location,s=window.location,o=(t==null?void 0:t.search)||s.search||"";if(o)return o;const e=t||s;return(e==null?void 0:e.search)||`?${e.toString().split("?")[1]}`}catch{return window.location.search||""}}}class F extends C{constructor(n){super(n),this.iframeURL=new URL(`${h}/elements?off=${this.options.offer}&checkoutMode=2`),console.debug("@@@@ Initializing InlineCheckout element")}}class L extends _{constructor(t){var l,y;const s={on_generate_tokens_intent_success:m=>{var a,r,i,d;this._resolveTokenization(m),(d=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onGenerateTokensSuccess)==null||d.call(i,m)},on_generate_tokens_intent_error:m=>{var a,r,i,d;this._rejectTokenization(m),(d=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onGenerateTokensError)==null||d.call(i,m)},on_credit_card_form_valid:()=>{var m,a,r,i;(i=(r=(a=(m=this.options)==null?void 0:m.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:r.onValidationSuccess)==null||i.call(r)},on_credit_card_form_invalid:m=>{var a,r,i,d;(d=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onValidationError)==null||d.call(i,m)},on_credit_card_form_blur:m=>{var a,r,i,d;(d=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onBlur)==null||d.call(i,m)},on_credit_card_info:m=>{var a,r,i,d;(d=(i=(r=(a=this.options)==null?void 0:a.elementOptions)==null?void 0:r.creditCardForm)==null?void 0:i.onCardInfoUpdate)==null||d.call(i,m)}},o=(y=(l=t.elementOptions)==null?void 0:l.creditCardForm)==null?void 0:y.gateways,e=o&&Array.isArray(o)&&o.length?o:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX","YUNO"];t.elementOptions={...t.elementOptions,creditCardForm:{...t.elementOptions.creditCardForm,gateways:e}};super(t,s);f(this,"TOKENIZATION_TIMEOUT",12e3);f(this,"pendingTokenization",null);this.iframeURL=new URL(`${T}/elements/credit-card-form`),this.iframeOptions={minHeight:"235px",minWidth:"210px"},console.debug("@@@@ Initializing creditCardForm element")}async generateTokens(){return this.pendingTokenization?Promise.reject(new Error("Tokenization already in progress")):new Promise((t,s)=>{const o=setTimeout(()=>this._rejectTokenization(new Error("Tokenization timeout")),this.TOKENIZATION_TIMEOUT);this.pendingTokenization={resolve:e=>{clearTimeout(o),this.pendingTokenization=null,t(e)},reject:e=>{clearTimeout(o),this.pendingTokenization=null,s(e)}};try{this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}catch(e){this._rejectTokenization(e)}})}_resolveTokenization(t){this.pendingTokenization&&this.pendingTokenization.resolve(t)}_rejectTokenization(t){this.pendingTokenization&&this.pendingTokenization.reject(t)}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const E=(c,n={})=>{var e;if(n.off&&(n.offer=n.off),!(n.offer||n.affiliation)&&["overlayCheckout","inlineCheckout"].includes(c))throw new Error("Offer or affiliation must be present");if(c==="element:creditCardForm"&&!((e=n.elementOptions)!=null&&e.creditCardForm.context))throw new Error("Context must be present on credit card form elements options");const o={overlayCheckout:()=>new x(n),inlineCheckout:()=>new F(n),salesFunnel:()=>new U(n),jsInterface:()=>new O(n),"element:creditCardForm":()=>new L(n)};if(console.debug("@@@@ Initializing Checkout Elements"),!u.includes(c))throw new Error(`Element type ${c} not available, please check the documentation`);return o[c]()},P=10;let k=0;function w(){window.setTimeout(()=>{if(k>=P)return;k+=1;const c=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!c.length){w();return}c.some(n=>n.hasChildNodes())||E("salesFunnel").mount(c[0])},250)}w(),window.checkoutElements={init:E};const z=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
