(function(u){typeof define=="function"&&define.amd?define(u):u()})(function(){"use strict";var R=Object.defineProperty;var P=(u,p,m)=>p in u?R(u,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[p]=m;var y=(u,p,m)=>(P(u,typeof p!="symbol"?p+"":p,m),m);const u=["overlayCheckout","salesFunnel","inlineCheckout","element:creditCardForm"],p=(r,e)=>{const n=document.createElement("iframe");return e&&(n.id=e),n.className="custom-element__iframe",n.style.width="100%",n.style.minWidth="320px",n.style.minHeight="300px",n.style.border="0 none",n.style.display="block",n.allow="clipboard-write; payment *",n.src=r,n},m="https://pay.hotmart.com";class w{constructor(e,n){y(this,"options",{payment:{},visibilityOptions:{}});y(this,"wrapperElement");y(this,"iframeElement");y(this,"iframeURL",new URL(m));this.options=e,console.debug("@@@@ this.options:",this.options);const o={...{elements_document_height_update:t=>{this.iframeElement&&(this.iframeElement.style.height=t)},on_load:()=>{var t,a,f,d,l,c,s,h,b,g,k;this.postMessage({action:"set_data",data:{shopperData:(t=this.options.payment)==null?void 0:t.shopperData,hasErrorCallback:!!((a=this.options.payment)!=null&&a.onError),countryIsoCode:((f=this.options)==null?void 0:f.countryIsoCode)??"",gateways:(c=(l=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:l.creditCardForm)==null?void 0:c.gateways,context:(b=(h=(s=this.options)==null?void 0:s.elementOptions)==null?void 0:h.creditCardForm)==null?void 0:b.context}}),(k=(g=this.options)==null?void 0:g.onLoad)==null||k.call(g)}},...n||{}};window.addEventListener("message",t=>{var f;const a=t.source!==((f=this.iframeElement)==null?void 0:f.contentWindow);t.origin!==m||a||(console.debug("@@@@ message:",t),!(!t.data.action||!Object.keys(o).includes(t.data.action))&&o[t.data.action](t.data.data))})}updateOptions(e){this.options={...this.options,...e}}postMessage({action:e,data:n}){var i,o;(o=(i=this.iframeElement)==null?void 0:i.contentWindow)==null||o.postMessage({action:e,data:n},"*")}mount(e){var i;if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[o,t]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(o,t);if(this.options.visibilityOptions)for(const[o,t]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(o,t);const n=p(this.iframeURL.href);this.iframeElement=n,this.wrapperElement=typeof e=="string"?document.querySelector(e):e,this.wrapperElement&&(this.wrapperElement.innerHTML="",(i=this.wrapperElement)==null||i.appendChild(n),console.debug("@@@@ element mounted successfully"))}}class C extends w{constructor(e,n){const i={on_payment_approve:o=>{var t,a;(a=(t=this.options.payment)==null?void 0:t.onSuccess)==null||a.call(t,o)},on_payment_error:o=>{var t,a;(a=(t=this.options.payment)==null?void 0:t.onError)==null||a.call(t,o)},on_submit_payment:({actionToCall:o})=>{var t,a;this.postMessage({action:"process_payment",data:{shopperData:(t=this.options.payment)==null?void 0:t.shopperData,hasErrorCallback:!!((a=this.options.payment)!=null&&a.onError),actionToCall:o}})},...n||{}};super(e,i),this.iframeURL=new URL(`${m}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class O extends C{constructor(e){super(e),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>U).then(n=>{const i=document.createElement("style");i.innerText=n.default,document.head.append(i)})}onKeyUp(e){e.key==="Escape"&&this.destroy()}attach(e){const n=typeof e=="string"?document.querySelector(e):e;e&&(n==null||n.addEventListener("click",i=>{i.preventDefault();const o=document.createElement("div");o.id="custom-element-lightbox-overlay",o.className="custom-element__lightbox-overlay",o.addEventListener("click",()=>{this.destroy()});const t=document.createElement("div");t.id="custom-element-lightbox-modal",t.className="custom-element__lightbox-modal",super.mount(t),document.body.appendChild(o),document.body.appendChild(t)}),document.addEventListener("keyup",i=>this.onKeyUp(i)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(e){this.attach(e)}destroy(){var e,n;(e=document.getElementById("custom-element-lightbox-overlay"))==null||e.remove(),(n=document.getElementById("custom-element-lightbox-modal"))==null||n.remove()}}class x extends C{constructor(e){super(e),this.iframeURL=new URL(`${m}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var e;try{const n=(e=window.top)==null?void 0:e.location,i=window.location,o=(n==null?void 0:n.search)||i.search||"";if(o)return o;const t=n||i;return(t==null?void 0:t.search)||`?${t.toString().split("?")[1]}`}catch{return window.location.search||""}}}class F extends C{constructor(e){super(e),this.iframeURL=new URL(`${m}/elements?off=${this.options.offer}&checkoutMode=2`),console.debug("@@@@ Initializing InlineCheckout element")}}class L extends w{constructor(e){var t,a,f;const n={on_generate_tokens_intent_success:d=>{var l,c,s,h;(h=(s=(c=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:c.creditCardForm)==null?void 0:s.onGenerateTokensSuccess)==null||h.call(s,d)},on_generate_tokens_intent_error:d=>{var l,c,s,h;(h=(s=(c=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:c.creditCardForm)==null?void 0:s.onGenerateTokensError)==null||h.call(s,d)},on_credit_card_form_valid:()=>{var d,l,c,s;(s=(c=(l=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:l.creditCardForm)==null?void 0:c.onValidationSuccess)==null||s.call(c)},on_credit_card_form_invalid:d=>{var l,c,s,h;(h=(s=(c=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:c.creditCardForm)==null?void 0:s.onValidationError)==null||h.call(s,d)}},i=(a=(t=e.elementOptions)==null?void 0:t.creditCardForm)==null?void 0:a.gateways,o=i&&Array.isArray(i)&&i.length?i:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX","YUNO"];e.elementOptions={...e.elementOptions,creditCardForm:{...(f=e.elementOptions)==null?void 0:f.creditCardForm,gateways:o,context:e.elementOptions.creditCardForm.context}},super(e,n),this.iframeURL=new URL(`${m}/elements/credit-card-form`),console.debug("@@@@ Initializing creditCardForm element")}generateTokens(){this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const E=(r,e={})=>{var t;if(e.off&&(e.offer=e.off),!(e.offer||e.affiliation)&&["overlayCheckout","inlineCheckout"].includes(r))throw new Error("Offer or affiliation must be present");if(r==="element:creditCardForm"&&!((t=e.elementOptions)!=null&&t.creditCardForm.context))throw new Error("Context must be present on credit card form elements options");const o={overlayCheckout:()=>new O(e),inlineCheckout:()=>new F(e),salesFunnel:()=>new x(e),"element:creditCardForm":()=>new L(e)};if(console.debug("@@@@ Initializing Checkout Elements"),!u.includes(r))throw new Error("Element type not available, please check the documentation");return o[r]()},I=10;let _=0;function v(){window.setTimeout(()=>{if(_>=I)return;_+=1;const r=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!r.length){v();return}r.some(e=>e.hasChildNodes())||E("salesFunnel").mount(r[0])},250)}v(),window.checkoutElements={init:E};const U=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
